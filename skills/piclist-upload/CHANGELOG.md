# 变更日志

## [1.1.0] - 2026-01-21

### 新增

- **自动删除本地图片**: 上传成功后默认删除本地图片文件，节省存储空间
- **`--keep-local` 选项**: 支持保留本地图片文件，用户可选择是否删除

### 修复

- **修复脚本意外退出问题**: 原脚本使用 `set -e` 导致计数器为 0 时返回退出码 1，脚本被终止
  - 改用 `set -o pipefail` + `let` 命令进行计数，避免计数器导致脚本退出
- **修复一行多图片处理问题**: 原脚本逐行处理，一行有多个 `![]()` 时只处理第一个
  - 改用正则循环 + 字符串替换，正确处理一行中的所有图片引用

### 技术优化

- 新增 `delete_local_image()` 函数处理本地图片删除逻辑
- 使用关联数组 `declare -A uploaded_files` 追踪已上传文件
- 优化图片匹配正则表达式，支持复杂 Markdown 场景
- 改进路径规范化处理，兼容更多路径格式

### 文档更新

- 更新 SKILL.md，补充 `--keep-local` 选项说明
- 新增命令选项表格，清晰展示各选项功能
- 更新工作流程说明，明确默认删除本地图片的行为

---

## [1.0.0] - 2026-01-09

### 新增

- 初始版本发布：PicList 图片上传技能，支持通过 PicList HTTP Server 接口上传 Markdown 中的本地图片到图床
- 支持单个/多个 Markdown 文件批量处理
- 支持目录扫描：自动发现并处理指定目录下的所有 `.md` 文件
- 支持两种输出模式：
  - `--dry-run`：预览模式，显示上传结果但不修改原文件
  - `--in-place`：替换模式，直接修改原文件，将本地路径替换为云端 URL
- 智能过滤：自动跳过已经是云端链接（`http://`、`https://`）的图片，避免重复上传
- 相对路径解析：自动将 Markdown 中的相对路径解析为绝对路径
- 统计报告：显示上传成功、跳过和失败的图片数量
- 错误处理：文件不存在或上传失败时保留原路径，继续处理其他图片

### 技术优化

- 使用 Bash 脚本实现图片上传和 Markdown 文件处理
- 通过 curl 调用 PicList HTTP Server API（默认端口 36677）
- 支持环境变量 `PICLIST_SERVER` 自定义服务器地址
- 逐行解析 Markdown 文件，精确替换图片链接
- 保留原始 alt 文本描述

### 支持格式

- png, jpg, jpeg, gif, webp, svg, bmp

### 文档完善

- 添加 PicList 安装与配置指南（references/setup.md），包含：
  - 各平台下载安装方法
  - HTTP Server 启用步骤
  - 主流图床配置示例（GitHub、阿里云 OSS、腾讯云 COS、SM.MS）
  - 配置验证方法
- 更新 SKILL.md 前置条件，明确指向配置文档

### 改进

- 添加启动预检查：在处理前自动检测 PicList HTTP Server 连接状态
- 提供友好的错误提示：当服务不可用时，显示配置指南和下载地址
- 连接超时设置为 3 秒，快速反馈服务状态
