# API å‚è€ƒæ–‡æ¡£

## ç«¯ç‚¹åˆ—è¡¨

| æ–¹æ³• | è·¯å¾„ | æè¿° |
|------|------|------|
| GET | `/health` | å¥åº·æ£€æŸ¥ |
| POST | `/transcribe` | è½¬å½•å•ä¸ªæ–‡ä»¶ |
| POST | `/batch_transcribe` | æ‰¹é‡è½¬å½•ç›®å½• |

## 1. å¥åº·æ£€æŸ¥

æ£€æŸ¥æœåŠ¡çŠ¶æ€å’Œè¿è¡Œä¿¡æ¯ã€‚

**è¯·æ±‚**

```bash
GET /health
```

**å“åº”ç¤ºä¾‹**

```json
{
  "status": "ok",
  "service": "FunASR Transcribe",
  "uptime": 300,
  "idle_time": 120
}
```

**å“åº”å­—æ®µ**

| å­—æ®µ | ç±»å‹ | æè¿° |
|------|------|------|
| `status` | string | æœåŠ¡çŠ¶æ€ï¼Œ"ok" è¡¨ç¤ºæ­£å¸¸è¿è¡Œ |
| `service` | string | æœåŠ¡åç§° |
| `uptime` | integer | æœåŠ¡è¿è¡Œæ—¶é—´ï¼ˆç§’ï¼‰ |
| `idle_time` | integer | å½“å‰ç©ºé—²æ—¶é—´ï¼ˆç§’ï¼‰ |

## 2. è½¬å½•å•ä¸ªæ–‡ä»¶

å°†éŸ³é¢‘æˆ–è§†é¢‘æ–‡ä»¶è½¬å½•ä¸º Markdown æ–‡æ¡£ã€‚

**è¯·æ±‚**

```bash
POST /transcribe
Content-Type: application/json

{
  "file_path": "/path/to/audio.mp3",
  "output_path": "/path/to/output.md",
  "diarize": false
}
```

**è¯·æ±‚å‚æ•°**

| å‚æ•° | ç±»å‹ | å¿…éœ€ | æè¿° |
|------|------|------|------|
| `file_path` | string | æ˜¯ | è¦è½¬å½•çš„æ–‡ä»¶ç»å¯¹è·¯å¾„ |
| `output_path` | string | å¦ | è¾“å‡º Markdown æ–‡ä»¶è·¯å¾„ï¼ˆé»˜è®¤ï¼šåŸæ–‡ä»¶åŒç›®å½•ä¸‹çš„ .md æ–‡ä»¶ï¼‰ |
| `diarize` | boolean | å¦ | æ˜¯å¦å¯ç”¨è¯´è¯äººåˆ†ç¦»ï¼ˆé»˜è®¤ï¼šfalseï¼‰ |

**æ”¯æŒçš„æ ¼å¼**

- **è§†é¢‘**ï¼šmp4, avi, mov, mkv, wmv, webm
- **éŸ³é¢‘**ï¼šmp3, wav, m4a, flac, aac, opus, wma, caf

**å“åº”ç¤ºä¾‹ï¼ˆæˆåŠŸï¼‰**

```json
{
  "success": true,
  "output_path": "/path/to/audio.md",
  "text": "è¿™æ˜¯è½¬å½•çš„æ–‡æœ¬å†…å®¹...",
  "sentence_count": 25
}
```

**å“åº”å­—æ®µ**

| å­—æ®µ | ç±»å‹ | æè¿° |
|------|------|------|
| `success` | boolean | è½¬å½•æ˜¯å¦æˆåŠŸ |
| `output_path` | string | ç”Ÿæˆçš„ Markdown æ–‡ä»¶è·¯å¾„ |
| `text` | string | è½¬å½•çš„çº¯æ–‡æœ¬å†…å®¹ |
| `sentence_count` | integer | è½¬å½•å¥å­æ•°é‡ |
| `error` | string | é”™è¯¯ä¿¡æ¯ï¼ˆä»…å¤±è´¥æ—¶è¿”å›ï¼‰ |

**å“åº”ç¤ºä¾‹ï¼ˆå¤±è´¥ï¼‰**

```json
{
  "success": false,
  "error": "æ–‡ä»¶ä¸å­˜åœ¨: /path/to/audio.mp3"
}
```

**å®Œæ•´ç¤ºä¾‹**

```bash
# åŸºç¡€è½¬å½•
curl -X POST http://127.0.0.1:8765/transcribe \
  -H "Content-Type: application/json" \
  -d '{"file_path": "/path/to/audio.mp3"}'

# æŒ‡å®šè¾“å‡ºè·¯å¾„
curl -X POST http://127.0.0.1:8765/transcribe \
  -H "Content-Type: application/json" \
  -d '{"file_path": "/path/to/video.mp4", "output_path": "/path/to/transcript.md"}'

# å¯ç”¨è¯´è¯äººåˆ†ç¦»
curl -X POST http://127.0.0.1:8765/transcribe \
  -H "Content-Type: application/json" \
  -d '{"file_path": "/path/to/meeting.m4a", "diarize": true}'
```

## 3. æ‰¹é‡è½¬å½•

è½¬å½•ç›®å½•ä¸­çš„æ‰€æœ‰æ”¯æŒæ–‡ä»¶ã€‚

**è¯·æ±‚**

```bash
POST /batch_transcribe
Content-Type: application/json

{
  "directory": "/path/to/media_folder",
  "output_dir": "/path/to/output_folder",
  "diarize": false
}
```

**è¯·æ±‚å‚æ•°**

| å‚æ•° | ç±»å‹ | å¿…éœ€ | æè¿° |
|------|------|------|------|
| `directory` | string | æ˜¯ | è¦è½¬å½•çš„ç›®å½•ç»å¯¹è·¯å¾„ |
| `output_dir` | string | å¦ | è¾“å‡ºç›®å½•ï¼ˆé»˜è®¤ï¼šåŒè¾“å…¥ç›®å½•ï¼‰ |
| `diarize` | boolean | å¦ | æ˜¯å¦å¯ç”¨è¯´è¯äººåˆ†ç¦»ï¼ˆé»˜è®¤ï¼šfalseï¼‰ |

**å“åº”ç¤ºä¾‹ï¼ˆæˆåŠŸï¼‰**

```json
{
  "success": true,
  "total": 3,
  "results": [
    {
      "file": "/path/to/audio1.mp3",
      "output": "/path/to/output/audio1.md",
      "success": true
    },
    {
      "file": "/path/to/audio2.wav",
      "output": "/path/to/output/audio2.md",
      "success": true
    },
    {
      "file": "/path/to/video.mp4",
      "output": "/path/to/output/video.md",
      "success": false,
      "error": "æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒ"
    }
  ]
}
```

**å“åº”å­—æ®µ**

| å­—æ®µ | ç±»å‹ | æè¿° |
|------|------|------|
| `success` | boolean | æ‰¹é‡æ“ä½œæ˜¯å¦æˆåŠŸ |
| `total` | integer | è¦è½¬å½•çš„æ–‡ä»¶æ€»æ•° |
| `results` | array | æ¯ä¸ªæ–‡ä»¶çš„è½¬å½•ç»“æœ |
| `results[].file` | string | åŸå§‹æ–‡ä»¶è·¯å¾„ |
| `results[].output` | string | è¾“å‡ºæ–‡ä»¶è·¯å¾„ï¼ˆä»…æˆåŠŸæ—¶ï¼‰ |
| `results[].success` | boolean | å•æ–‡ä»¶è½¬å½•æ˜¯å¦æˆåŠŸ |
| `results[].error` | string | é”™è¯¯ä¿¡æ¯ï¼ˆä»…å¤±è´¥æ—¶ï¼‰ |
| `error` | string | æ‰¹é‡æ“ä½œé”™è¯¯ä¿¡æ¯ï¼ˆä»…å¤±è´¥æ—¶è¿”å›ï¼‰ |

**å®Œæ•´ç¤ºä¾‹**

```bash
# æ‰¹é‡è½¬å½•ç›®å½•
curl -X POST http://127.0.0.1:8765/batch_transcribe \
  -H "Content-Type: application/json" \
  -d '{"directory": "/path/to/media_folder"}'

# æŒ‡å®šè¾“å‡ºç›®å½•
curl -X POST http://127.0.0.1:8765/batch_transcribe \
  -H "Content-Type: application/json" \
  -d '{"directory": "/path/to/media_folder", "output_dir": "/path/to/output"}'

# å¯ç”¨è¯´è¯äººåˆ†ç¦»
curl -X POST http://127.0.0.1:8765/batch_transcribe \
  -H "Content-Type: application/json" \
  -d '{"directory": "/path/to/meetings", "diarize": true}'
```

## 4. AI æ€»ç»“åŠŸèƒ½ï¼ˆClaude Code ç¯å¢ƒï¼‰

è½¬å½•å®Œæˆåï¼Œå¯ä»¥ä½¿ç”¨ AI æ€»ç»“åŠŸèƒ½å¯¹è½¬å½•å†…å®¹è¿›è¡Œæ™ºèƒ½åˆ†æå’Œæ€»ç»“ã€‚

**æ³¨æ„**ï¼šAI æ€»ç»“åŠŸèƒ½ä¸“ä¸º Claude Code ç¯å¢ƒè®¾è®¡ï¼Œä½¿ç”¨ Claude çš„åŸç”Ÿ AI èƒ½åŠ›ï¼Œæ— éœ€é…ç½®å¤–éƒ¨ APIã€‚

### 4.1 å·¥ä½œæµç¨‹

1. æ‰§è¡Œè½¬å½•å‘½ä»¤
2. è½¬å½•å®Œæˆåè‡ªåŠ¨ç”Ÿæˆæ€»ç»“æç¤ºè¯
3. å°†æç¤ºè¯å‘é€ç»™ Claude AI ç”Ÿæˆç»“æ„åŒ–æ€»ç»“
4. Claude è¿”å› JSON æ ¼å¼çš„æ€»ç»“ç»“æœ
5. å°†æ€»ç»“æ³¨å…¥åˆ° Markdown æ–‡ä»¶

### 4.2 ä½¿ç”¨æ–¹æ³•

#### é»˜è®¤æ¨¡å¼ï¼ˆæ¨èï¼‰

```bash
# è½¬å½•å•ä¸ªæ–‡ä»¶ï¼ˆè‡ªåŠ¨å¯ç”¨æ€»ç»“ï¼‰
python scripts/transcribe.py /path/to/audio.mp3

# å¯ç”¨è¯´è¯äººåˆ†ç¦»å¹¶ç”Ÿæˆæ€»ç»“
python scripts/transcribe.py /path/to/meeting.m4a --diarize
```

è½¬å½•å®Œæˆåä¼šè‡ªåŠ¨æ˜¾ç¤ºæ€»ç»“æç¤ºè¯ã€‚

#### ç¦ç”¨æ€»ç»“

```bash
# è½¬å½•ä½†ä¸ç”Ÿæˆæ€»ç»“
python scripts/transcribe.py /path/to/audio.mp3 --no-summary
```

### 4.3 æ€»ç»“å†…å®¹ç»“æ„

AI æ€»ç»“åŠŸèƒ½ä¼šç”Ÿæˆï¼š

1. **å…¨æ–‡æ€»ç»“** - è‡³å°‘ 400 å­—ï¼Œåˆ†æˆ 2-3 æ®µï¼ŒåŒ…å«èƒŒæ™¯ã€é—®é¢˜ã€å…³é”®äº‹å®ã€æ•°æ®ã€é£é™©ä¸è¡ŒåŠ¨å»ºè®®
2. **å‘è¨€äººæ€»ç»“** - æ¯ä¸ªå‘è¨€äººçš„è§‚ç‚¹ã€ä¾æ®ã€æ•°æ®ã€æ€åº¦ä¸æ½œåœ¨å½±å“ï¼ˆè‡³å°‘ 180 å­—/äººï¼‰
3. **é‡ç‚¹å†…å®¹** - 6-10 æ¡é‡ç‚¹ï¼Œæ¯æ¡ 60-100 å­—ï¼Œæ˜ç¡®äº‹å®/æ•°æ®/ç»“è®º/è¡ŒåŠ¨
4. **å…³é”®è¯** - 5-8 ä¸ªå…³é”®è¯

æ€»ç»“ç»“æœä¼šç›´æ¥æ’å…¥åˆ°è½¬å½•çš„ Markdown æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨ `<!-- AI-SUMMARY:START -->` å’Œ `<!-- AI-SUMMARY:END -->` æ ‡è®°ã€‚

### 4.4 æç¤ºè¯ç‰¹ç‚¹

- ä¸“é—¨é’ˆå¯¹ä¸­æ–‡å£è¯­åŒ–å¯¹è¯ä¼˜åŒ–
- ä¿ç•™å‘è¨€äººä¸Šä¸‹æ–‡å’Œå¯¹è¯æµç¨‹
- è‡ªåŠ¨è¯†åˆ«å‘è¨€äººé¡ºåºï¼ˆspeaker_0, speaker_1 ç­‰ï¼‰
- ç»“æ„åŒ– JSON è¾“å‡ºä¾¿äºè§£æå’Œæ ¼å¼åŒ–

### 4.5 ç¤ºä¾‹

**è½¬å½•è¾“å‡ºç¤ºä¾‹**ï¼š

```text
âœ… è½¬å½•å®Œæˆ
ğŸ“„ è¾“å‡º: /path/to/audio.md
ğŸ“ å¥å­æ•°: 25

ğŸ¤– æ­£åœ¨å‡†å¤‡ AI æ€»ç»“...

============================================================
ğŸ“‹ è¯·å°†ä»¥ä¸‹æç¤ºè¯å‘é€ç»™ Claude AI ä»¥ç”Ÿæˆæ€»ç»“ï¼š
============================================================
ä½ æ˜¯ä¸€ä½æ“…é•¿å¤„ç†å£è¯­åŒ–ä¸­æ–‡å¯¹è¯çš„ä¸“ä¸šçºªè¦åˆ†æå¸ˆã€‚è¯·ä»éç»“æ„åŒ–é€å­—ç¨¿ä¸­æç‚¼äº‹ä»¶è„‰ç»œã€å„æ–¹è§‚ç‚¹ã€å…³é”®æ•°æ®å’Œè¡ŒåŠ¨å»ºè®®ï¼Œä¿æŒå®¢è§‚ï¼Œä¸æé€ ä¿¡æ¯ã€‚

è¯·é˜…è¯»ä»¥ä¸‹é€å­—ç¨¿ï¼Œè¾“å‡º JSON ç»“æœï¼Œå…¶ç»“æ„å¿…é¡»ä¸ºï¼š
{
  "full_summary": "è‡³å°‘400å­—ï¼Œåˆ†æˆ2-3æ®µï¼Œäº¤ä»£èƒŒæ™¯ã€é—®é¢˜ã€å…³é”®äº‹å®ã€æ•°æ®ã€é£é™©ä¸è¡ŒåŠ¨å»ºè®®",
  "speaker_summary": [
    {
      "speaker_order": "å‘è¨€äºº1",
      "speaker_name": "å¦‚èƒ½è¯†åˆ«è¯·å†™å§“åï¼Œå¦åˆ™å†™æœªçŸ¥",
      "summary": "è‡³å°‘180å­—ï¼Œæ¶µç›–è¯¥å‘è¨€äººçš„è§‚ç‚¹ã€ä¾æ®ã€æ•°æ®ã€æ€åº¦ä¸æ½œåœ¨å½±å“"
    }
  ],
  "highlights": ["6-10æ¡é‡ç‚¹ï¼Œæ¯æ¡60-100å­—ï¼Œæ˜ç¡®äº‹å®/æ•°æ®/ç»“è®º/è¡ŒåŠ¨"],
  "keywords": ["5-8ä¸ªå…³é”®è¯"]
}

è¯·ç¡®ä¿é€å­—ç¨¿ä¸­å‡ºç°çš„æ¯ä¸€ä½å‘è¨€äººï¼ˆå‘è¨€äºº1ã€å‘è¨€äºº2â€¦â€¦ï¼‰éƒ½æä¾›æ€»ç»“ï¼Œä¸å¾—é—æ¼æˆ–è™šæ„ã€‚

ä»¥ä¸‹æ˜¯å®Œæ•´æ–‡æœ¬ï¼š
[è½¬å½•æ–‡æœ¬å†…å®¹...]

è¯·è¾“å‡º JSON æ ¼å¼çš„æ€»ç»“ã€‚
============================================================
```

